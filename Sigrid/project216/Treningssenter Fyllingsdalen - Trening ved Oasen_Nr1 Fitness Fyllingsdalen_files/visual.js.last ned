jQuery(document).ready(function() {
    window.keep_opacity = 0;
	
	jQuery('.bookWeek').hover(function() {
		//jQuery('div.visualInstance', jQuery('li.bookEntry')).animate({opacity: 0.7}, 200);
		jQuery('div.visualInstance', jQuery('li.bookEntry')).addClass('visualInstanceDim');
	},
	function() {
		if (keep_opacity == 0) {
			//jQuery('div.visualInstance', jQuery('li.bookEntry')).animate({opacity: 1.0}, 200);
			jQuery('div.visualInstance', jQuery('li.bookEntry')).removeClass('visualInstanceDim');
		}
	});
	
	jQuery('div.visualInstance', jQuery('li.bookEntry')).hover(function() {
		//jQuery(this).animate({opacity: 1.0}, 10);
		jQuery(this).removeClass('visualInstanceDim');
		jQuery(this).addClass('visualInstanceHover');
	},
	function() {
		//jQuery(this).animate({opacity: 0.7}, 10);
		jQuery(this).addClass('visualInstanceDim');
		jQuery(this).removeClass('visualInstanceHover');
	});

	jQuery('#instanceInfo').dialog({
		autoOpen: false,
		draggable: false,
		resizable: false,
		width: 500,
		modal: false,
		show: "fade",
		dialogClass: 'instanceDialog',
		open: function(event, ui) {
				jQuery('body').bind('click', function(event)	{
					if (event.target.id != "") {
						//closeVisualInfo();			
					}
				});
				jQuery('#instanceInfo').bind('click', function(event) {
					if (event.target.id != "") {
						closeVisualInfo();			
					}
				});
		}		
	});

	jQuery('.ui-button').hover(	
	  function () {
	    jQuery(this).addClass('hoverButton');
	  },
	  function () {
	    jQuery(this).removeClass('hoverButton');
	  }
	);
	
});

function showVisualInfo(id, date, time, timeto, book_url, book_image, book_text) {

	var windowWidth = jQuery(window).width();

	if (jQuery('#visual' + id).length) {
		var classLeftPosition = jQuery('#visual' + id).position().left;
	} else {
		var classLeftPosition = 30;
	}

	if (classLeftPosition + 560 > windowWidth || jQuery('#visual' + id).length <= 0) {
		if (jQuery('#visual' + id).length) {
			var x = jQuery(window).width() - 560;
		} else {
			var x = jQuery('.bookWeek').position().left + 30;
		}
	} else {
		var tx = (520 - jQuery('#visual' + id).width()) / 2;
		var x = jQuery('#visual' + id).position().left - tx;
		if (x < 0) {
			var x = jQuery('.bookWeek').position().left + 30;
		}
	}
	if (jQuery('#visual' + id).length) {
		var y = jQuery('#visual' + id).position().top - 30;
	} else {
		var y = jQuery('.bookWeek').position().top - 30;
	}
 	keep_opacity = 1;
	jQuery.getJSON("/showdesc/get_instance_info.php",
	  {
	    iid : id
	  },
	  function(dataObject) {
			if (dataObject.main.activityDesc != '' || dataObject.main.hasVideo || dataObject.main.activityImage != "../images/" || dataObject.support.instructorImage != "../images/" || dataObject.support.instructorDesc != "") {
			} else {
				jQuery('#instanceInfo').dialog('close');
				return;
			}
			jQuery("#instanceInfo").dialog('option', 'position', [x,y]);
			jQuery("#instanceInfo #instanceInfoHeader").html('');
			jQuery("#instanceInfo #instanceInfoMain").html('');
			jQuery("#instanceInfo #instanceInfoInstructorIntro").html('');
			jQuery("#instanceInfo #instanceInfoImage").html('');
			jQuery("#instanceInfo #instanceInfoInstructorImage").html('');
			jQuery("#instanceInfo #instanceInfoBookButton").html('');
			jQuery("#instanceInfo #instanceInfoHeader").html(dataObject.header.title + ' <span class="instanceInfoDate">' + date + ' ' + time + ' - ' + timeto + '</span>');
			jQuery("#instanceInfo #instanceInfoMain").html(dataObject.main.activityDesc);
			jQuery("#instanceInfo #instanceInfoInstructorIntro").html(dataObject.support.instructor);
			if (dataObject.main.hasVideo) {
				jQuery("#instanceInfo #instanceInfoImage").html(dataObject.main.embedYoutubeHTML);
			} else if (dataObject.main.activityImage != "../images/") {
				jQuery("#instanceInfo #instanceInfoImage").html('<img src="' + dataObject.main.activityImage + '" />');
			}
			if (dataObject.support.instructorImage != "../images/") {
				jQuery("#instanceInfo #instanceInfoInstructorImage").html('<img src="' + dataObject.support.instructorImage + '" />');
			}
			jQuery("#instanceInfo #instanceInfoInstructorDesc").html(dataObject.support.instructorDesc);
			if (1 && book_text != "") {
				// Logged in as a member, display login button..
				jQuery("#instanceInfo #instanceInfoBookButton").html('<br /><br /><div><button type="button" onclick="location.href=\'/' + book_url + '\'" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text"><img style="float: left; margin-right: 5px; margin-top: 2px; margin-left: -5px;" src="' + book_image + '" /> ' + book_text + '</span></button></div>');
			}
			if (dataObject.main.activityDesc != '' || dataObject.main.hasVideo || dataObject.main.activityImage != "../images/" || dataObject.support.instructorImage != "../images/" || dataObject.support.instructorDesc != "") {
				if (jQuery(window).width() >= 560) {
				    setTimeout("jQuery('#instanceInfo').dialog('open')", 70);
				}
			} else {
				jQuery('#instanceInfo').dialog('close');
			}
	  });
}

function closeVisualInfo() {
    keep_opacity = 0;
	jQuery("#instanceInfo").dialog('close');
	jQuery("#instanceInfo #instanceInfoHeader").html('');
	jQuery("#instanceInfo #instanceInfoMain").html('');
	jQuery("#instanceInfo #instanceInfoInstructorIntro").html('');
	jQuery("#instanceInfo #instanceInfoImage").html('');
	jQuery("#instanceInfo #instanceInfoInstructorImage").html('');
	jQuery("#instanceInfo #instanceInfoBookButton").html('');
}